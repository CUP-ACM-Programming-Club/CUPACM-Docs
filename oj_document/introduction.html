<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CUP Online Judge开发文档 | CUPACM Documents</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="stylesheet" href="https://shadow.elemecdn.com/npm/katex@0.11.0/dist/katex.min.css">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/css/0.styles.2b207330.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/app.8ebb6025.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/2.99e4cc49.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/25.3ee12ce3.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/10.6d7bf1d8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/11.ee4f083c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/12.e1b3642f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/13.643342fa.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/14.d5005ad0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/15.f094bd7d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/16.fd3965b8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/17.54190182.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/18.99507dbf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/19.735a49f8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/20.d5a7f965.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/21.75e4e2ce.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/22.21461578.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/23.34d841eb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/24.4df3615c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/26.fe89308e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/27.ccafdfa1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/28.ec7dd340.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/29.a3d6ea45.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/3.f5541923.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/30.7ff8145a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/31.23c328b5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/32.8d6fabdf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/33.255c1048.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/34.bd20110d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/35.bfedc82a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/36.d0b3374c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/37.9def76c2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/38.a71a9962.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/39.f4787d7d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/4.323157c2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/5.3298eab7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/6.9a84c674.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/7.7df6496e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/8.28ac56a6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/9.d713df46.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/css/0.styles.2b207330.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/" class="home-link router-link-active"><!----> <span class="site-name">CUPACM Documents</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/code_template/" class="nav-link">
  模板库
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/solution/" class="nav-link">
  题解
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/contribute/" class="nav-link">
  构建本文档
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/" class="nav-link router-link-active">
  CUPOJ开发文档
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/tools/" class="nav-link">
  Jetbrains教育版申请
</a></div> <a href="https://github.com/CUP-ACM-Programming-Club/CUPACM-Docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/code_template/" class="nav-link">
  模板库
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/solution/" class="nav-link">
  题解
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/contribute/" class="nav-link">
  构建本文档
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/" class="nav-link router-link-active">
  CUPOJ开发文档
</a></div><div class="nav-item"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/tools/" class="nav-link">
  Jetbrains教育版申请
</a></div> <a href="https://github.com/CUP-ACM-Programming-Club/CUPACM-Docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/" class="sidebar-link">介绍</a></li><li><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html" class="active sidebar-link">CUP Online Judge开发文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#云化" class="sidebar-link">云化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#datasource" class="sidebar-link">Datasource</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#middleware" class="sidebar-link">Middleware</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#core" class="sidebar-link">Core</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#线上已知问题" class="sidebar-link">线上已知问题</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#typescript改造" class="sidebar-link">TypeScript改造</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#集群化" class="sidebar-link">集群化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#cluster" class="sidebar-link">Cluster</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#热更新" class="sidebar-link">热更新</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#为什么选用node-js作为后端" class="sidebar-link">为什么选用Node.js作为后端</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#程序架构" class="sidebar-link">程序架构</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#写在开发前" class="sidebar-link">写在开发前</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#node-js-runtime基于node-js-express开发的后端" class="sidebar-link">~~Node.js Runtime~~基于Node.js Express开发的后端</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#c-judger" class="sidebar-link">C++ Judger</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#一个提交的执行流程" class="sidebar-link">一个提交的执行流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#客户端" class="sidebar-link">客户端</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#服务器" class="sidebar-link">服务器</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#php与node-js之间如何共享用户数据" class="sidebar-link">PHP与Node.js之间如何共享用户数据</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#configmanager" class="sidebar-link">ConfigManager</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#config" class="sidebar-link">Config</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#switch" class="sidebar-link">Switch</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#node-js-router开发" class="sidebar-link">Node.js Router开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#interceptor" class="sidebar-link">Interceptor</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#node-js-module开发" class="sidebar-link">Node.js Module开发</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#node-js-socket-io开发" class="sidebar-link">Node.js Socket.IO开发</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#前端开发" class="sidebar-link">前端开发</a></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#git" class="sidebar-link">Git</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#版本" class="sidebar-link">版本</a></li></ul></li><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#发布" class="sidebar-link">发布</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/introduction.html#后端发布" class="sidebar-link">后端发布</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>CUP Online Judge</strong>是一个以Vue.js作为前端框架，ExpressJS 作为后端框架开发的在线评测系统。</p> <p><em>注: CUP Virtual Judge属于较为独立的、技术栈未成熟的另外一个程序，因此在本程序中不会涉及到与Virtual Judge系统相关的接口开发问题。</em></p> <p><strong>CUP Virtual Judge由于国内各大OJ调整对海外IP地址访问的策略，现在暂时停止提交功能，保留题目内容供查询。</strong></p> <h2 id="云化"><a href="#云化" class="header-anchor">#</a> 云化</h2> <h3 id="datasource"><a href="#datasource" class="header-anchor">#</a> Datasource</h3> <ul><li>MySQL 使用阿里云RDS MySQL服务器</li></ul> <h3 id="middleware"><a href="#middleware" class="header-anchor">#</a> Middleware</h3> <ul><li>判题机注册节点 <strong>待开发</strong></li></ul> <h3 id="core"><a href="#core" class="header-anchor">#</a> Core</h3> <ul><li>前端 已完成</li> <li>后端 已完成</li> <li>判题机 待开发</li></ul> <h2 id="线上已知问题"><a href="#线上已知问题" class="header-anchor">#</a> 线上已知问题</h2> <p>迁移至<a href="/discuss/thread/17">CUP Online Judge系统问题整理复盘</a> <s>* WebSocket进程有CPU hang100%的现象</s> <s>解决方案:排查中</s></p> <p><s>* 提交事件响应抖动造成冗余提交</s> <s>解决方案: 前端去颤加锁，后端加计时器</s></p> <p><s>* 发布有较大不确定性，有不可预估的风险</s> <s>解决方案: 新增部署dev环境-&gt;ppe环境-&gt;prod环境发布链，新发布统一走SOP变更。</s></p> <h2 id="typescript改造"><a href="#typescript改造" class="header-anchor">#</a> TypeScript改造</h2> <blockquote><p>动态一时爽，重构火葬场</p></blockquote> <p>为了杜绝以上情况的出现，现计划通过改造当前后端，使用TypeScript语言重构。</p> <p><strong>注: 使用TypeScript请务必抽象化规范化各种DO,减少不必要的<code>any</code>声明</strong></p> <p>如果你也对重构计划感兴趣，欢迎访问</p> <ul><li>(后端)<a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-Express/tree/typescript" target="_blank" rel="noopener noreferrer">CUP-Online-Judge-Express:typescript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>(前端)<a href="https://github.com/ryanlee2014/CUP-Online-Judge-NG-FrontEnd" target="_blank" rel="noopener noreferrer">CUP-Online-Judge-NG-FrontEnd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>为我们贡献代码</p> <h2 id="集群化"><a href="#集群化" class="header-anchor">#</a> 集群化</h2> <p>目前后端功能逐渐丰富，接口的数量也逐渐增加，带来的性能开销也越来越大。在高并发及高任务提交的环境下，数据库查询队列负载过重，同时CPU占用率高导致判题效率严重下降，造成较为严重的后果。</p> <p>在当天晚上通过使用Apache Bench对后端接口进行压测过程发现，服务器多个接口均存在不能耐受突发高并发请求的情况。包括但不限于：</p> <ul><li>问题历史页面接口: <code>problemstatus</code> (响应时间: 4s)</li> <li>问题集接口： <code>problemset</code> (响应时间:1s)</li> <li>竞赛列表接口： <code>contest</code> (响应时间: 800ms)</li> <li>...</li></ul> <p>原缓存模型为：
<div>undefined</div>
以上接口在面临高并发请求任务时，由于服务器本身缓存部分为MySQL任务结果，并没有对接口本身做缓存优化，因此存在以下缓存穿透的可能。</p> <p>在高并发环境下，对于SQL查询语句存在重复的情况，而部分慢查询不能及时将数据存到缓存层中，造成缓存穿透，所有请求直接打到数据库，造成后端服务器掉底。</p> <p>针对这种情况，可以考虑使用加锁进行优化。对于每个查询，先获得锁，然后进行查询缓存任务，完成后释放锁，保证后续任务能够直接命中缓存。</p> <div>undefined</div> <p>以上模型能够解决慢查询击穿数据库的问题。但是如果并发量较大，初始未加缓存的情况下仅能有一个查询在同时进行，性能还没有达到最优。这时候我们可以考虑维护锁管理器，对于每个查询按照指定的规则生成锁的键值，对于每类查询，保证只会命中特定的锁，而不影响其他无关查询的性能。</p> <div>undefined</div>&gt;
<p>通过以上几步优化，我们成功将原本并发量为1<s>也就是完全没有并发的杂鱼</s>提升为500rps上下。</p> <p>但是500rps并不能让我们停止对性能提升的追求。通过使用<code>top</code>工具观察压测过程中的资源使用情况，我们发现对于单进程，<code>node</code>已经跑满单核CPU的所有计算资源。我们知道，<code>Node.js</code>使用单线程维护事件队列保证异步高并发的运行环境。而我们显然需要发挥一台计算机多核的威力，不能仅实现一核有难，多核围观这一情况。</p> <h3 id="cluster"><a href="#cluster" class="header-anchor">#</a> Cluster</h3> <p>Node.js在官方库中提供了<code>Cluster</code>这一模块，使得Node应用能够以集群的形式运行在服务器上。</p> <p>我们可以通过启动一个<code>Master</code>进程，fork与CPU数量相当的<code>Worker</code>进程，由<code>Master</code>进程获得TCP连接，使用RoundRobin算法平均分配给各个进程，实现负载均衡。
<div>undefined</div>
但是为什么我没有一开始就用这种模型开发呢？
因为在我们系统中<strong>存在单例模式的组件，组件对变更事件敏感</strong>。
以下组件是要求严格单例模式且需要即时响应请求的:</p> <ol><li>判题模块</li> <li>ConfigManager</li> <li>在线用户管理</li> <li>WebSocket通信模块</li></ol> <p>其中(1)(3)(4)模块的抽象保证耦合，(2)模块要求即时同步更新。</p> <p>对于前面这种情况，我采用应用切分的方式实现功能的解耦合，将(1)(3)(4)作为一个新服务切分出来，在其他服务掉底的情况仍能保持判题功能。
<div>undefined</div></p> <p>后面这种情况，使用进程间通信保证一致性。
<div>undefined</div></p> <p>然后经过一番优化以后，上述几个瓶颈接口达到了惊人的2300rps,更不用说剩下一些不涉及数据存取的部分，性能提升相当显著。</p> <h3 id="热更新"><a href="#热更新" class="header-anchor">#</a> 热更新</h3> <p>考虑推线上发布的时候会短暂影响用户的使用体验，而在改造集群以后可以通过负载均衡分配任务给不同的Worker进程。因此可以通过现有的模型改造热更新方案。</p> <p>通过IPC通信通知Master进程重启，Master进程将Worker进程时间Promise化，实现平滑进程过渡，保证用户在无感知情况下实现更新。</p> <div>undefined</div> <h2 id="为什么选用node-js作为后端"><a href="#为什么选用node-js作为后端" class="header-anchor">#</a> 为什么选用Node.js作为后端</h2> <p>Node.js有以下优点:</p> <ul><li>单线程
<ul><li>协程</li></ul></li> <li>高并发
<ul><li>I/O密集</li></ul></li> <li>事件队列
<ul><li>事件驱动型后端</li></ul></li> <li><s>敏捷开发</s> <ul><li><s>前端后端一把梭</s></li></ul></li> <li>NPM</li></ul> <p>缺点:</p> <ul><li>不适用于计算密集型应用</li> <li>动态语言</li></ul> <blockquote><p>动态一时爽，重构火葬场
(TypeScript重构希望<s>在做了 在做了</s>)</p></blockquote> <ul><li>不够完善的后端生态</li></ul> <p>本文档使用GitHub作为版本控制工具，访问本文档旧版本内容请前往下列链接查看:
<a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-doc/blob/master/CUP-Online-Judge%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3.md" target="_blank">CUP-Online-Judge开发文档.md</a></p> <p>阅读本文档需要了解以下预备知识:</p> <ul><li>Node.js(v<s>10.0</s>12+)</li> <li>JavaScript(ES<s>5</s><s>6</s><s>7</s>10)</li> <li>TypeScript</li> <li>PHP(v7.0+)(<strong>Deprecated</strong>*)</li> <li>Linux</li> <li>C++(17+)**</li> <li>HTML(HTML5 is optional)</li> <li>Vue.js 2+</li> <li>CSS3</li> <li>SQL</li> <li>Redis</li> <li>Apache httpd(<strong>Deprecated</strong>)</li> <li>Nginx</li></ul> <p>*: PHP即将在<code>去PHP</code>计划中被删除。
**: ThreadPool使用了C++17语法特性(Lambda表达式)</p> <h2 id="程序架构"><a href="#程序架构" class="header-anchor">#</a> 程序架构</h2> <p>本程序参照了HUSTOJ与SYZOJ的架构，采用了MySQL + Node.js + Linux C/C++ <s>+ PHP</s>技术栈进行开发。</p> <p>下列列出的本程序的项目已经开源。</p> <ul><li><a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-Express" target="_blank">基于Node.js Express开发的后端</a></li> <li><a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-Judger" target="_blank">基于简易沙箱的判题机</a></li> <li><a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-docker-judger" target="_blank">基于Docker的判题机</a></li> <li><s><a href="https://github.com/CUP-ACM-Programming-Club/CUP_Online_Judge_Semantic_UI" target="_blank">基于Semantic UI构建的、使用Vue.js作为框架的前端</a></s><a href="https://github.com/ryanlee2014/CUP-Online-Judge-NG-FrontEnd" target="_blank">基于Vue-Cli 3.0构建的Vue.js单页应用程序</a></li> <li><a href="https://github.com/CUP-ACM-Programming-Club/CUP-Online-Judge-Problem-Packer" target="_blank">使用Electron Vue开发的跨平台题目打包管理器</a></li> <li><s><a href="https://github.com/ryanlee2014/HUSTOJ-Flat-UI-Theme" target="_blank">基于Flat UI开发的PHP事务下的主题</a></s></li></ul> <p>下列部分<s>暂未开源，或者</s>由于即将被替代/与其他开源项目的功能重复决定不做开源处理。</p> <ul><li>基于Medoo编写的旧版的PHP事务部分</li> <li>基于Semantic UI与Bootstrap开发的主题</li> <li>管理员管理后台</li></ul> <p>关于本程序采用的开源软件，请访问<a href="https://www.cupacm.com/opensource.php" target="_blank" rel="noopener noreferrer">开放源代码声明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看。</p> <h2 id="写在开发前"><a href="#写在开发前" class="header-anchor">#</a> 写在开发前</h2> <p>为了更好的方便内部模块间的协同工作，请认真理解本程序的工作流程，即使它非常的混乱、冗余。</p> <p>在为本程序进行开发时请时刻<s>牢记<strong>稳定</strong>与<strong>必要</strong>是该程序功能增改的一大原则</s>考虑以领域驱动设计(DDD)的角度对模组抽象化。</p> <p>以下是本程序在用户登录后模块间通信的图示。
<img src="https://raw.githubusercontent.com/CUP-ACM-Programming-Club/CUP-Online-Judge-doc/master/pic/program_structure.png" alt=""></p> <p>可以分为以下部分。</p> <h3 id="node-js-runtime基于node-js-express开发的后端"><a href="#node-js-runtime基于node-js-express开发的后端" class="header-anchor">#</a> <s>Node.js Runtime</s>基于Node.js Express开发的后端</h3> <p>使用ExpressJS框架，主要功能：</p> <ul><li>使用Socket.IO与用户进行双向通信</li> <li>CRUD(<strong>Deprecated:考虑到Node.js对运算密集部分的不友好，这部分将考虑使用微服务进行拆分</strong>)</li> <li>维护判题队列</li> <li>用户权限管理</li> <li>题目文件部署</li> <li>WebSocket转发</li> <li>信息广播</li></ul> <h4 id="程序文件夹"><a href="#程序文件夹" class="header-anchor">#</a> 程序文件夹</h4> <p>- root
--- static 静态文件文件夹(js库/css库)
--- route 路由文件夹(API接口)
--- manager 领域设计贫血模型
--- orm 数据库对象关系映射模型(Sequelize.js)
--- test 单元测试
--- bin 启动文件夹(程序启动文件)
--- module 模块文件夹(被其他文件调用)
--- middleware 中间件文件夹(中间件)
--- views 模版文件夹(pug文件模板)
--- logs 日志文件夹(日志)</p> <h4 id="程序启动-daemon"><a href="#程序启动-daemon" class="header-anchor">#</a> 程序启动(Daemon)</h4> <p><code>npm start</code></p> <h4 id="程序启动-debug"><a href="#程序启动-debug" class="header-anchor">#</a> 程序启动(Debug)</h4> <p><code>npm test</code></p> <h4 id="程序重启-daemon"><a href="#程序重启-daemon" class="header-anchor">#</a> 程序重启(Daemon)</h4> <p><code>npm restart</code></p> <h3 id="c-judger"><a href="#c-judger" class="header-anchor">#</a> C++ Judger</h3> <p>使用EasyWebsocket、HUSTOJ Judger进行重构、开发
主要功能:
判题:</p> <h2 id="一个提交的执行流程"><a href="#一个提交的执行流程" class="header-anchor">#</a> 一个提交的执行流程</h2> <h3 id="客户端"><a href="#客户端" class="header-anchor">#</a> 客户端</h3> <ol><li>用户点击<code>提交</code>按钮</li> <li>代码、token被打包，委托Socket.IO模块推送到Node.js Runtime</li> <li>Socket.IO模块接受<code>result</code>事件，调用挂在<code>window</code>上的<code>problemsubmitter</code>Vue实例，Vue实例执行相关操作，显示判题情况。</li></ol> <h3 id="服务器"><a href="#服务器" class="header-anchor">#</a> 服务器</h3> <h5 id="node-js-runtime"><a href="#node-js-runtime" class="header-anchor">#</a> Node.js Runtime</h5> <ol><li>(/bin/main.js)收到<code>submit</code>事件响应的数据，将数据移交<code>submitControl</code>模块，判断提交合法性并解包数据，存储至数据库中</li> <li>等待模块返回完成信号，建立socket连接与solution_id的映射，将判题任务移交到判题机</li> <li>判题机维护判题队列。
<ul><li>若队列空闲则直接唤起空闲判题机移交判题任务</li> <li>若队列非空，则赋予高优先权移交队列，等待判题机结束后询问队列，入队判题</li></ul></li> <li>通过WebSocket模块接收来自判题机的判题信息，通过查阅solution_id对应的socket连接，将数据转发给对应socket</li> <li>WebSocket模块通过检测完成信号，释放相关资源</li> <li>判题机判题结束，检查队列任务，若队列非空，则获取队列头的任务进行判题，若队列为空，则判题机入空闲队列</li></ol> <h4 id="c-judger-2"><a href="#c-judger-2" class="header-anchor">#</a> C++ Judger</h4> <ol><li><p>被Node.js Runtime唤醒，建立简易沙箱环境，<s>获取MySQL连接</s>目前开启<code>-no-mysql</code>模式，会变为使用Node.js通过WebSocket传送数据至后端</p></li> <li><p>初始化系统调用，载入数据文件</p></li> <li><p>判断提交类型</p> <ul><li>测试运行：不进行答案比对，直接返回评测数据，程序结束</li> <li>正常提交：根据题目内容进行评测，根据数据库取出的数据决定判题方法为<code>文本对比</code>或<code>Special Judge</code> <ul><li>文本对比：对比标准输出与用户输出的内容，返回<code>Wrong Answer</code>/<code>Presentation Error</code>/<code>Accept</code>信息</li> <li>Special Judge: 将输入文件、输出文件、用户输出、用户代码传入程序，根据程序退出时返回的值决定判题结果。理论上可以返回所有的判题结果。</li></ul></li></ul></li> <li><p>数据保存，更新用户数据与题目数据</p></li> <li><p>退出程序</p></li></ol> <h2 id="php与node-js之间如何共享用户数据"><a href="#php与node-js之间如何共享用户数据" class="header-anchor">#</a> PHP与Node.js之间如何共享用户数据</h2> <p>在每次访问PHP页面时，<code>/include/db_info.inc.php</code>文件作为所有PHP文件的头文件被引入到PHP文件中，该文件包括了数据库相关的函数初始化以及缓存数据库的初始化。同时该文件会生成一个和用户<code>user_id</code>相关的<code>token</code>,并将<code>token</code>和<code>user_id</code>一同保存在cookie中，在页面进行XHR时cookie会一同发送到Node.js运行时环境</p> <p>若访问的是Vue单页应用(即当前生效的页面),<code>generate_token</code>中间件会在<code>cookie</code>中添加一个<code>newToken</code>及<code>user_id</code>字段，并通过Redis为List: ${user_id}newToken添加一个新的token,PHP页面通过<code>/include/db_info.inc.php</code>进行登录鉴权。</p> <h2 id="configmanager"><a href="#configmanager" class="header-anchor">#</a> ConfigManager</h2> <p>ConfigManager是一个系统参数及开关状态的统一管理模块，通过设置存储模块和日志模块进行可持久化及日志回滚操作。</p> <p>模块支持使用<strong>MySQL</strong>及<strong>Redis</strong>进行持久化。</p> <p>该模块目前在后端用于灰度发布及动态配置管理。</p> <h3 id="config"><a href="#config" class="header-anchor">#</a> Config</h3> <p>Config是一个运行时根据管理员设置动态改变的key-value配置。开发者可以在任何需要动态配置的地方插入<code>ConfigManager.getConfig(key)</code>获得Config数据。需要注意的是<code>key</code>值是唯一的，<code>Config</code>表不能有重复key值存在。</p> <h3 id="switch"><a href="#switch" class="header-anchor">#</a> Switch</h3> <p>Switch是一个运行时根据管理员设置的动态改变的开关。开关的值为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>100</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,100]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">]</span></span></span></span>,其中开关值代表开关打开的概率。不难发现，0代表开关关闭，100代表开关打开，而中间态代表开关有一定概率是打开状态，而概率为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>%。在每次调用<code>ConfigManager.isSwitchedOn(key)</code>的时候，系统会随机生成一个<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>100</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,100]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">]</span></span></span></span>的数与设置的数进行大小对比以获得开关状态。
显然，Switch是一种特殊的Config。</p> <p><strong>ConfigManager在系统中是一个单例模块</strong></p> <h2 id="node-js-router开发"><a href="#node-js-router开发" class="header-anchor">#</a> Node.js Router开发</h2> <p>要使前端能够调用接口，访问数据，就需要开发对应的Router响应时间。所有的Router文件均放置于文件夹<code>/router</code>下。编写Router的方式与Express.js官网的模板相似，只需导出数组</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;router_path&quot;</span><span class="token punctuation">,</span> middleware<span class="token punctuation">,</span> Router<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就能够被app.js自动在启动时载入。</p> <h3 id="interceptor"><a href="#interceptor" class="header-anchor">#</a> Interceptor</h3> <p>对于部分需要根据后台配置管理的路由，可以在暴露的数组中添加<code>Interceptor</code>中间件，从<code>/module/interceptor/middleware.js</code>中通过<code>InterceptorFactory</code>配置<code>validator</code>,使用<code>getInterceptorInstance</code>获得拦截器实例放入路由出参middleware中即可。</p> <p><code>validator</code>: boolean Function(req, res), 传入<code>request</code>，<code>response</code>对象，根据返回值决定是否调用<code>next()</code>执行下一个中间件。</p> <p>可以配合<code>ConfigManager</code>中的<code>switch</code>及<code>config</code>进行动态更改开闭状态。</p> <h2 id="node-js-module开发"><a href="#node-js-module开发" class="header-anchor">#</a> Node.js Module开发</h2> <p>所有的后台功能若是能够抽象的，应该开发成<code>Module</code>以供使用。开发的Module存放在<code>/module</code>文件夹下即可</p> <h2 id="node-js-socket-io开发"><a href="#node-js-socket-io开发" class="header-anchor">#</a> Node.js Socket.IO开发</h2> <p>该模块是后台程序诞生的原因<s>显示在线人数</s>,因此这里的代码是所有代码中历史最久远的部分。目前还没有整理方便置入中间件或绑定响应时间的接口。请等待版本更新。</p> <h2 id="前端开发"><a href="#前端开发" class="header-anchor">#</a> 前端开发</h2> <p>前端是本系统中一个非常重要的部分。考虑到服务器本身对CPU的依赖，于是所有的非保密数据的运算均由客户端(即用户浏览器)运算得出。</p> <p>本平台界面采用Semantic UI进行构建，因此能够支持<s>Semantic UI</s>Fomantic UI最新文档下的所有模块及特效。</p> <p>大多数的页面由最新版本的Vue.js驱动。由于<code>去PHP计划</code>还没有全面完成，部分页面仍将使用旧版的PHP模块驱动。
目前还使用PHP模块驱动的页面有(此处不考虑CUP Virtual Judge):</p> <ul><li><s>竞赛及作业</s></li> <li><s>管理员后台</s></li> <li><s>编译错误页面</s></li> <li><s>运行错误页面</s></li> <li>注册页面*</li></ul> <p>删除在<code>3.0.0-alpha</code>版本中已重构的部分
*: 正在重构中</p> <p>以上的页面将在不久的将来被Vue页面替代，因此在这些页面上进行功能增删需要三思。</p> <p>当前所有的前端请求均通过<strong>AJAX</strong>与后端保持通信，<s>考虑到Semantic UI仍然基于jQuery进行开发，为了减少过多第三方库的引入，建议直接使用jQuery的接口进行XHR请求</s>请直接在<code>CUP-Online-Judge-NG-Frontend</code>中使用<code>this.axios</code>进行AJAX操作。</p> <p>有少数的功能不能够使用AJAX通信，而必须使用Socket.IO接口与后端通信。</p> <ul><li>历史页面最新提交的更新</li> <li>题目提交页面评测题目</li> <li>黑板</li> <li>全局信息推送</li> <li>建立WebSocket时提交的环境数据</li> <li>在线用户情况</li> <li>评测队列</li></ul> <h2 id="git"><a href="#git" class="header-anchor">#</a> Git</h2> <h3 id="版本"><a href="#版本" class="header-anchor">#</a> 版本</h3> <p>开发版本格式为：<code>${major-version}.${maintain-version}.${bugfix-version/refactor-version/hotfix-version}[optional: ${alpha|beta|ppe}]</code></p> <h4 id="如何针对代码的改变选择适合的版本号变化"><a href="#如何针对代码的改变选择适合的版本号变化" class="header-anchor">#</a> 如何针对代码的改变选择适合的版本号变化</h4> <p>当出现以下变化的，大版本增加:</p> <ul><li>核心代码完全重构</li> <li>环境更改</li></ul> <p>当出现以下变化的，小版本增加:</p> <ul><li>增加前/后端模块链</li> <li>修改前/后端模块链</li> <li>新增/修改Plugin</li> <li>新增非重要功能</li> <li>删除模块/UI更改</li></ul> <p>当出现以下变化时，修复版本增加:</p> <ul><li>修复Bugs</li> <li>更新依赖</li> <li>更正typo</li> <li>新增/修改测试用例</li> <li>无感知的功能重构</li></ul> <h2 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h2> <p><strong>非线上紧急修复问题，一律禁止在高峰期进行任何发布</strong></p> <h3 id="后端发布"><a href="#后端发布" class="header-anchor">#</a> 后端发布</h3> <h4 id="websocket发布"><a href="#websocket发布" class="header-anchor">#</a> WebSocket发布</h4> <p>该服务为单例应用，重启过程没有任何安全措施。请尽可能于低峰期发布。
未来将考虑接入主Cluster节点。</p> <h4 id="功能发布"><a href="#功能发布" class="header-anchor">#</a> 功能发布</h4> <p>该服务涉及除判题机及在线用户以外的所有服务，目前可采用安全的在线热部署进行重启。</p> <p>热部署触发链接:<a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/api/admin/system/hot-reload/">Hot-Reload</a></p> <p>管理员通过以下链接Notify主进程进行重启作业。重启失败时，现有Worker将不会被替代。</p> <p>同理，主进程相关逻辑为单例应用，重启过程有一定的安全措施，但也请务必在低峰期更改。</p> <p>Master重启流程</p> <div>undefined</div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/CUP-ACM-Programming-Club/CUPACM-Docs/edit/master/docs/oj_document/introduction.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2/14/2020, 2:26:23 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/https:/cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/oj_document/" class="prev router-link-active">
        介绍
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/app.8ebb6025.js" defer></script><script src="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/2.99e4cc49.js" defer></script><script src="https://cdn.jsdelivr.net/gh/CUP-ACM-Programming-Club/CUPACM-Docs-CDN@v1/assets/js/25.3ee12ce3.js" defer></script>
  </body>
</html>
